alias: Światło 1-1 [Sypialnia]
description: Toggle, single press i jasność pokrętłem IKEA E2490 (skalowanie z null na max)
triggers:
  - device_id: twoje id
    domain: mqtt
    type: action
    subtype: "on"
    id: ikea-toggle
    trigger: device
  - device_id: teoje id
    domain: mqtt
    type: action
    subtype: "off"
    id: ikea-toggle
    trigger: device
  - device_id: twoje id
    domain: mqtt
    type: action
    subtype: single
    id: switch-single
    trigger: device
  - trigger: mqtt
    topic: zigbee2mqtt/remote02
    id: ikea-brightness
conditions: []
actions:
  - choose:
      - conditions:
          - condition: trigger
            id: ikea-toggle
        sequence:
          - target:
              entity_id: light.sypialnia_xiaomi_zarowka_01
            action: light.toggle
      - conditions:
          - condition: trigger
            id: switch-single
        sequence:
          - action: light.toggle
            target:
              entity_id:
                - light.sypialnia_xiaomi_zarowka_01
            data:
              brightness_pct: 100
      - conditions:
          - condition: trigger
            id: ikea-brightness
          - condition: template
            value_template: |
              {{ trigger.payload_json.action == 'brightness_move_to_level' }}
        sequence:
          - target:
              entity_id: light.sypialnia_xiaomi_zarowka_01
            data:
              brightness: |
                {% if trigger.payload_json.action_level is none %}
                  255
                {% else %}
                  {{ ((trigger.payload_json.action_level | int) * 255 / 254) | round(0) }}
                {% endif %}
            action: light.turn_on
mode: single
